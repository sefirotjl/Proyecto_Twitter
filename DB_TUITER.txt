create database tuiter;
use tuiter;
CREATE TABLE PERSONA (
             IDPERSONA INT NOT NULL AUTO_INCREMENT,
             CORREO CHAR(30) NOT NULL,
	     PASSWORD CHAR(30) NOT NULL,
	     NOMBRE CHAR(30),
             PRIMARY KEY (IDPERSONA)
             );

INSERT INTO PERSONA (CORREO, PASSWORD, NOMBRE) VALUES('SUAREZ_MANUEL@HOTMAIL.COM',15,'MANUEL SUAREZ'),
					             ('JORGE@RENTERIA.COM',1,'JORGE RENTERIA'),
						     ('JUAN@GMAIL.COM','JUAN','JUAN PEDRO'),
						     ('PEDRO@GMAIL.COM','PEDRO','PEDRO JUAN');


CREATE TABLE MENSAJE (
             IDMENSAJE INT NOT NULL AUTO_INCREMENT,
             IDPERSONA INT NOT NULL,
	     MENSAJE CHAR(130) NOT NULL,
             PRIMARY KEY (IDMENSAJE)
             );

INSERT INTO MENSAJE (IDPERSONA, MENSAJE) VALUES(1,'ESTE ES EL PRIMER TUIT DEL USUARIO 1 MANUEL #GEORGEESGAY'),
(2,'ESTE EL PRIMER TUIT DE 2 JORGE @SUAREZ_MANUEL@HOTMAIL.COM'),
(3,'ESTE DE PEDRO JUAN #GEORGEESGAY');


CREATE TABLE HASH (
             IDHASH INT NOT NULL AUTO_INCREMENT,
             IDMENSAJE INT NOT NULL,
	     MENSAJE CHAR(130) NOT NULL,
             PRIMARY KEY (IDHASH)
             );


INSERT INTO HASH (IDMENSAJE, MENSAJE) VALUES(1,'GEORGEESGAY'),(3,'GEORGEESGAY');

CREATE TABLE SIGUIENDO (
             IDPERSONA INT NOT NULL,
             IDSIGUE INT NOT NULL
             );

INSERT INTO SIGUIENDO (IDPERSONA, IDSIGUE) VALUES(1,3),(2,1),(1,1),(2,2),(3,3),(4,4);

CREATE TABLE PERSONA_EN_MENSAJE (
             IDPERSONA INT NOT NULL,
             IDMENSAJE INT NOT NULL
             );

INSERT INTO PERSONA_EN_MENSAJE (IDPERSONA, IDMENSAJE) VALUES(1,2);

delimiter #
CREATE TRIGGER sigue_ami AFTER INSERT ON PERSONA
  FOR EACH ROW BEGIN
    INSERT INTO SIGUIENDO (IDPERSONA, IDSIGUE) VALUES (NEW.IDPERSONA,NEW.IDPERSONA);
  END#
delimiter ;

//ESTE DA TODOS LOS TUITS MIOS Y DE LAS PERSONAS QUE SIGO

SELECT M.MENSAJE FROM MENSAJE M, SIGUIENDO S WHERE S.IDPERSONA=1 AND S.IDSIGUE=M.IDPERSONA;

//ESTE DA TODOS LOS TUITS EN LOS QUE APAREZCO SIN SEGUIR AL USUARIO QUE LO PUBLICO

SELECT M.MENSAJE FROM MENSAJE M, SIGUIENDO S, PERSONA_EN_MENSAJE P WHERE P.IDPERSONA=1 AND P.IDMENSAJE=M.IDMENSAJE;

//ESTE DA TODOS LOS TUITS DE LAS PERSONAS QUE SIGO, EN LOS TUITS QUE APAREZCO Y LOS MIOS

SELECT M.MENSAJE FROM MENSAJE M, SIGUIENDO S WHERE S.IDPERSONA=1 AND S.IDSIGUE=M.IDPERSONA UNION SELECT M.MENSAJE FROM MENSAJE M, SIGUIENDO S, PERSONA_EN_MENSAJE P WHERE P.IDPERSONA=1 AND P.IDMENSAJE=M.IDMENSAJE;

//CUENTA EL NUMERO DE APARICIONES DE UN HASH TAG

 SELECT COUNT(*), MENSAJE FROM HASH GROUP BY MENSAJE;







